<!DOCTYPE html>
<!-- santi.wtf - powered by vibes -->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Santi's Desktop</title>
    <link rel="icon" type="image/png" href="icons/computer_2_cool-0.png">
    <!-- Preconnect to external domains -->
    <link rel="preconnect" href="https://www.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://santi-guestbook-default-rtdb.firebaseio.com" crossorigin>
    <link rel="dns-prefetch" href="https://subscribe-forms.beehiiv.com">
    <!-- Preload critical icons -->
    <link rel="preload" href="icons/html-0.png" as="image">
    <link rel="preload" href="icons/html-1.png" as="image">
    <!-- Firebase SDK - deferred to not block rendering -->
    <script defer src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script defer src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <!-- Beehiiv -->
    <script async src="https://subscribe-forms.beehiiv.com/embed.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'MS Sans Serif', Arial, sans-serif;
            overflow: hidden;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100"><defs><filter id="noise"><feTurbulence baseFrequency="0.9" numOctaves="4"/><feColorMatrix values="0 0 0 0 0.4, 0 0 0 0 0.6, 0 0 0 0 0.9, 0 0 0 0.3 0"/></filter></defs><rect width="100" height="100" filter="url(%23noise)"/></svg>'),
                        linear-gradient(180deg, #1084d0 0%, #0f6bb5 50%, #0e5a9e 100%);
            background-size: 200px, 100%;
            height: 100vh;
            cursor: default;
            user-select: none;
        }

        .desktop {
            height: calc(100vh - 28px);
            padding: 10px;
            position: relative;
        }

        .desktop-watermark {
            position: absolute;
            bottom: 10px;
            right: 15px;
            font-family: monospace;
            font-size: 11px;
            color: #fff;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
            opacity: 0.7;
        }

        .icon {
            width: 70px;
            text-align: center;
            margin-bottom: 20px;
            cursor: pointer;
            position: absolute;
        }

        .icon-img {
            font-size: 32px;
            margin: 0 auto 4px;
            text-align: center;
            line-height: 1;
        }

        .icon-img img {
            width: 32px;
            height: 32px;
            image-rendering: pixelated;
            image-rendering: crisp-edges;
            -ms-interpolation-mode: nearest-neighbor;
        }

        .title-icon img {
            width: 16px;
            height: 16px;
            image-rendering: pixelated;
            image-rendering: crisp-edges;
            -ms-interpolation-mode: nearest-neighbor;
        }

        .icon-label {
            color: #fff;
            font-size: 11px;
            text-shadow: 1px 1px 2px #000;
            padding: 2px 4px;
        }

        .icon.selected .icon-label {
            background: #000080;
        }

        .window {
            position: absolute;
            background: #c0c0c0;
            border: 2px solid;
            border-color: #dfdfdf #808080 #808080 #dfdfdf;
            min-width: 400px;
            min-height: 200px;
            box-shadow: 2px 2px 0 rgba(0,0,0,0.2);
            display: none;
            resize: both;
            overflow: hidden;
        }

        .resize-handle {
            position: absolute;
            bottom: 0;
            right: 0;
            width: 16px;
            height: 16px;
            cursor: nwse-resize;
            background: linear-gradient(135deg, 
                transparent 0%, transparent 40%, 
                #808080 40%, #808080 45%, 
                transparent 45%, transparent 50%,
                #808080 50%, #808080 55%,
                transparent 55%, transparent 60%,
                #808080 60%, #808080 65%,
                transparent 65%);
        }

        .window.active {
            z-index: 1000;
        }

        .title-bar {
            background: linear-gradient(90deg, #000080, #1084d0);
            padding: 2px 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: move;
        }

        .window:not(.active) .title-bar {
            background: linear-gradient(90deg, #808080, #a0a0a0);
        }

        .title-text {
            color: #fff;
            font-size: 11px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .title-icon {
            font-size: 14px;
            line-height: 1;
        }

        .title-buttons {
            display: flex;
            gap: 2px;
        }

        .title-btn {
            width: 16px;
            height: 14px;
            background: #c0c0c0;
            border: 1px solid;
            border-color: #fff #000 #000 #fff;
            font-size: 9px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-weight: bold;
        }

        .title-btn:active {
            border-color: #000 #fff #fff #000;
        }

        .menu-bar {
            background: #c0c0c0;
            border-bottom: 1px solid #808080;
            padding: 2px 4px;
            font-size: 11px;
        }

        .menu-item {
            display: inline-block;
            padding: 2px 6px;
            cursor: pointer;
        }

        .menu-item:hover {
            background: #000080;
            color: #fff;
        }

        .toolbar {
            background: #c0c0c0;
            padding: 4px;
            border-bottom: 1px solid #808080;
            display: flex;
            gap: 2px;
        }

        .toolbar-btn {
            width: 24px;
            height: 22px;
            background: #c0c0c0;
            border: 1px solid;
            border-color: #fff #000 #000 #fff;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
        }

        .toolbar-btn:active {
            border-color: #000 #fff #fff #000;
        }

        .address-bar {
            background: #fff;
            border: 1px solid;
            border-color: #808080 #dfdfdf #dfdfdf #808080;
            padding: 3px 4px;
            margin: 4px;
            font-size: 11px;
        }

        .window-content {
            background: #fff;
            height: calc(100% - 100px);
            overflow-y: auto;
            padding: 20px;
            font-size: 12px;
            line-height: 1.4;
            user-select: text;
            cursor: text;
        }

        .window-content p {
            margin-bottom: 16px;
        }

        .window-content h1 {
            font-size: 24px;
            margin-bottom: 12px;
            text-align: center;
        }

        .window-content h2 {
            font-size: 18px;
            margin: 24px 0 12px;
        }

        .window-content a {
            color: #0000ff;
            text-decoration: underline;
        }

        .window-content a:visited {
            color: #800080;
        }

        .taskbar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 28px;
            background: #c0c0c0;
            border-top: 2px solid #fff;
            display: flex;
            align-items: center;
            padding: 2px;
            gap: 2px;
        }

        .start-btn {
            height: 24px;
            padding: 0 6px;
            background: #c0c0c0;
            border: 1px solid;
            border-color: #fff #000 #000 #fff;
            display: flex;
            align-items: center;
            gap: 4px;
            cursor: pointer;
            font-weight: bold;
            font-size: 11px;
        }

        .start-btn:active {
            border-color: #000 #fff #fff #000;
        }

        .start-icon {
            font-size: 16px;
            line-height: 1;
        }

        .taskbar-items {
            flex: 1;
            display: flex;
            gap: 2px;
        }

        .taskbar-item {
            height: 22px;
            padding: 0 8px;
            background: #c0c0c0;
            border: 1px solid;
            border-color: #fff #000 #000 #fff;
            display: flex;
            align-items: center;
            gap: 4px;
            cursor: pointer;
            font-size: 11px;
            max-width: 150px;
        }

        .taskbar-item.active {
            border-color: #000 #fff #fff #000;
        }

        .system-tray {
            height: 22px;
            padding: 0 6px;
            border: 1px solid;
            border-color: #808080 #dfdfdf #dfdfdf #808080;
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 11px;
        }

        .start-menu {
            position: fixed;
            bottom: 28px;
            left: 2px;
            width: 200px;
            background: #c0c0c0;
            border: 2px solid;
            border-color: #dfdfdf #000 #000 #dfdfdf;
            display: none;
        }

        .start-menu.open {
            display: block;
        }

        .start-menu-header {
            background: linear-gradient(90deg, #000080, #1084d0);
            color: #fff;
            padding: 4px 8px;
            font-size: 14px;
            font-weight: bold;
        }

        .start-menu-item {
            padding: 4px 8px 4px 8px;
            cursor: pointer;
            font-size: 11px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .start-menu-item:hover {
            background: #000080;
            color: #fff;
        }

        .start-menu-item img {
            width: 16px;
            height: 16px;
            image-rendering: pixelated;
            image-rendering: crisp-edges;
        }

        /* Shut Down Dialog */
        .shutdown-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 128, 0.3);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        .shutdown-overlay.open {
            display: flex;
        }

        .shutdown-dialog {
            background: #c0c0c0;
            border: 2px solid;
            border-color: #dfdfdf #808080 #808080 #dfdfdf;
            box-shadow: 4px 4px 0 rgba(0,0,0,0.3);
            max-width: 420px;
            width: 90%;
        }

        .shutdown-dialog .title-bar {
            cursor: default;
        }

        .shutdown-content {
            padding: 16px;
            text-align: center;
        }

        .shutdown-content p {
            font-size: 12px;
            margin-bottom: 16px;
            line-height: 1.5;
        }

        .shutdown-content .beehiiv-embed {
            width: 100% !important;
            max-width: 100% !important;
            border: 1px solid #808080;
            background: #fff;
        }

        .shutdown-buttons {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-top: 16px;
        }

        .shutdown-btn {
            padding: 4px 16px;
            background: #c0c0c0;
            border: 2px solid;
            border-color: #fff #000 #000 #fff;
            font-size: 11px;
            font-family: 'MS Sans Serif', Arial, sans-serif;
            cursor: pointer;
        }

        .shutdown-btn:active {
            border-color: #000 #fff #fff #000;
        }

        /* Clippy Assistant */
        .clippy-container {
            position: fixed;
            bottom: 50px;
            right: 20px;
            z-index: 8888;
            display: none;
        }

        .clippy-container.show {
            display: block;
            animation: clippy-bounce 0.5s ease;
        }

        @keyframes clippy-bounce {
            0% { transform: scale(0) translateY(20px); opacity: 0; }
            50% { transform: scale(1.1) translateY(-5px); }
            100% { transform: scale(1) translateY(0); opacity: 1; }
        }

        .clippy-bubble {
            background: #ffffcc;
            border: 2px solid #000;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 8px;
            position: relative;
            width: 260px;
            font-size: 12px;
            box-shadow: 2px 2px 0 rgba(0,0,0,0.3);
        }

        .clippy-bubble::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 30px;
            border-width: 10px 10px 0;
            border-style: solid;
            border-color: #000 transparent transparent;
        }

        .clippy-bubble::before {
            content: '';
            position: absolute;
            bottom: -7px;
            left: 32px;
            border-width: 8px 8px 0;
            border-style: solid;
            border-color: #ffffcc transparent transparent;
            z-index: 1;
        }

        .clippy-bubble p {
            margin: 0 0 10px 0;
            line-height: 1.4;
        }

        .clippy-buttons {
            display: flex;
            gap: 6px;
        }

        .clippy-btn {
            padding: 3px 10px;
            font-size: 11px;
            background: #c0c0c0;
            border: 2px solid;
            border-color: #fff #000 #000 #fff;
            cursor: pointer;
            font-family: 'MS Sans Serif', Arial, sans-serif;
        }

        .clippy-btn:active {
            border-color: #000 #fff #fff #000;
        }

        .clippy-btn.primary {
            background: #000080;
            color: #fff;
        }

        .clippy-character {
            font-size: 48px;
            cursor: pointer;
            filter: drop-shadow(2px 2px 0 rgba(0,0,0,0.3));
            transition: transform 0.2s;
        }

        .clippy-character:hover {
            transform: scale(1.1) rotate(-5deg);
        }

        .clippy-close {
            position: absolute;
            top: 4px;
            right: 6px;
            font-size: 14px;
            cursor: pointer;
            color: #666;
        }

        .clippy-close:hover {
            color: #000;
        }

        .chat-window .window-content {
            padding: 0;
            height: calc(100% - 24px);
            display: flex;
            flex-direction: column;
            font-family: 'MS Sans Serif', Tahoma, sans-serif;
        }

        #mycomputer .window-content {
            height: calc(100% - 24px);
        }

        #flowgarden .window-content {
            height: calc(100% - 24px);
            padding: 0;
            overflow: hidden;
        }

        /* Status Box - AIM Style */
        .chat-status-box {
            background: linear-gradient(180deg, #f5f5f5 0%, #e0e0e0 100%);
            border-bottom: 2px solid #808080;
            padding: 8px 10px;
            display: flex;
            align-items: flex-start;
            gap: 8px;
        }

        .chat-status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-top: 2px;
            flex-shrink: 0;
            border: 1px solid #404040;
        }

        .chat-status-indicator.online {
            background: radial-gradient(circle at 30% 30%, #44ff44, #00aa00);
            box-shadow: 0 0 4px #00ff00;
        }

        .chat-status-indicator.away {
            background: radial-gradient(circle at 30% 30%, #ffdd44, #cc9900);
            box-shadow: 0 0 4px #ffcc00;
        }

        .chat-status-content {
            flex: 1;
            min-width: 0;
        }

        .chat-status-name {
            font-weight: bold;
            font-size: 12px;
            color: #000080;
            margin-bottom: 2px;
        }

        .chat-status-message {
            font-size: 11px;
            color: #333;
            font-style: italic;
            word-wrap: break-word;
        }

        .chat-status-lastseen {
            font-size: 9px;
            color: #808080;
            margin-top: 3px;
        }

        /* Chat Messages Area */
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
            background: #fff;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .chat-bubble {
            max-width: 85%;
            padding: 8px 12px;
            border-radius: 12px;
            font-size: 11px;
            position: relative;
            word-wrap: break-word;
        }

        .chat-bubble.visitor {
            background: #e8e8e8;
            border: 1px solid #c0c0c0;
            align-self: flex-start;
            border-bottom-left-radius: 4px;
        }

        .chat-bubble.owner {
            background: #000080;
            color: #fff;
            align-self: flex-end;
            border-bottom-right-radius: 4px;
        }

        .chat-bubble-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 4px;
            gap: 8px;
        }

        .chat-bubble-name {
            font-weight: bold;
            font-size: 10px;
        }

        .chat-bubble.visitor .chat-bubble-name {
            color: #333;
        }

        .chat-bubble.owner .chat-bubble-name {
            color: #aaccff;
        }

        .chat-bubble-time {
            font-size: 9px;
            opacity: 0.7;
            flex-shrink: 0;
        }

        .chat-bubble-text {
            line-height: 1.4;
        }

        .chat-bubble .chat-delete {
            position: absolute;
            top: -6px;
            right: -6px;
            background: #ff4444;
            color: #fff;
            border: 1px solid #aa0000;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            font-size: 10px;
            padding: 0;
            cursor: pointer;
            display: none;
            line-height: 14px;
            text-align: center;
        }

        .chat-bubble .chat-delete:hover {
            background: #ff0000;
        }

        .admin-mode .chat-bubble .chat-delete {
            display: block;
        }

        /* Chat Input Area */
        .chat-input-area {
            background: #c0c0c0;
            border-top: 2px solid #808080;
            padding: 8px;
        }

        .chat-input-form {
            display: flex;
            gap: 6px;
        }

        .chat-input-name {
            width: 80px;
            padding: 4px 6px;
            border: 2px inset #808080;
            font-size: 11px;
            font-family: 'MS Sans Serif', Tahoma, sans-serif;
        }

        .chat-input-message {
            flex: 1;
            padding: 4px 6px;
            border: 2px inset #808080;
            font-size: 11px;
            font-family: 'MS Sans Serif', Tahoma, sans-serif;
            resize: none;
        }

        .chat-input-send {
            padding: 4px 12px;
            background: #c0c0c0;
            border-top: 2px solid #fff;
            border-left: 2px solid #fff;
            border-bottom: 2px solid #808080;
            border-right: 2px solid #808080;
            cursor: pointer;
            font-size: 11px;
            font-family: 'MS Sans Serif', Tahoma, sans-serif;
            font-weight: bold;
        }

        .chat-input-send:active {
            border-top: 2px solid #808080;
            border-left: 2px solid #808080;
            border-bottom: 2px solid #fff;
            border-right: 2px solid #fff;
        }

        /* Admin Panel */
        .chat-admin-panel {
            background: #ffffcc;
            border-bottom: 2px solid #808080;
            padding: 8px;
            display: none;
        }

        .admin-mode .chat-admin-panel {
            display: block;
        }

        .chat-admin-title {
            font-size: 10px;
            font-weight: bold;
            color: #804000;
            margin-bottom: 6px;
        }

        .chat-admin-row {
            display: flex;
            gap: 6px;
            margin-bottom: 6px;
        }

        .chat-admin-row:last-child {
            margin-bottom: 0;
        }

        .chat-admin-input {
            flex: 1;
            padding: 3px 6px;
            border: 1px solid #808080;
            font-size: 10px;
            font-family: 'MS Sans Serif', Tahoma, sans-serif;
        }

        .chat-admin-btn {
            padding: 3px 8px;
            background: #c0c0c0;
            border: 1px solid;
            border-color: #fff #404040 #404040 #fff;
            cursor: pointer;
            font-size: 10px;
            font-family: 'MS Sans Serif', Tahoma, sans-serif;
        }

        .chat-admin-btn:active {
            border-color: #404040 #fff #fff #404040;
        }

        .chat-admin-status-row {
            display: flex;
            gap: 6px;
            align-items: center;
        }

        .chat-admin-status-select {
            padding: 2px 4px;
            font-size: 10px;
            font-family: 'MS Sans Serif', Tahoma, sans-serif;
        }

        .player-window {
            min-width: 260px !important;
            min-height: 180px !important;
        }

        .player-window .window-content {
            background: #c0c0c0;
            padding: 0;
            height: calc(100% - 24px);
            display: flex;
            flex-direction: column;
        }

        /* Windows 98 Media Player */
        .media-player {
            background: #c0c0c0;
            padding: 4px;
            font-family: 'MS Sans Serif', 'Fixedsys', Tahoma, sans-serif;
        }

        .media-display {
            background: #000;
            border: 2px inset #808080;
            padding: 8px;
            margin-bottom: 4px;
        }

        .media-visualizer {
            display: flex;
            align-items: flex-end;
            justify-content: center;
            gap: 2px;
            height: 35px;
            margin-bottom: 6px;
        }

        .viz-bar {
            width: 8px;
            background: linear-gradient(to top, #00aa00 0%, #00ff00 50%, #aaff00 75%, #ffff00 90%, #ff0000 100%);
            transition: height 0.1s ease;
        }

        .media-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .media-ticker {
            color: #00ff00;
            font-family: 'Fixedsys', 'Courier New', monospace;
            font-size: 11px;
            flex: 1;
            overflow: hidden;
            white-space: nowrap;
            position: relative;
        }

        .media-ticker-text {
            display: inline-block;
            padding-left: 100%;
            animation: marquee 12s linear infinite;
        }

        .media-ticker-text.paused {
            animation-play-state: paused;
            padding-left: 0;
        }

        @keyframes marquee {
            0% { transform: translateX(0); }
            100% { transform: translateX(-200%); }
        }

        .media-time {
            font-family: 'Fixedsys', 'Courier New', monospace;
            font-size: 12px;
            color: #00ff00;
            margin-left: 10px;
            flex-shrink: 0;
        }

        .media-seek-row {
            padding: 4px 0;
        }

        .media-seek {
            width: 100%;
            height: 20px;
            background: #c0c0c0;
            border-top: 2px solid #808080;
            border-left: 2px solid #808080;
            border-bottom: 2px solid #ffffff;
            border-right: 2px solid #ffffff;
            cursor: pointer;
            position: relative;
        }

        .media-seek-track {
            position: absolute;
            top: 50%;
            left: 4px;
            right: 4px;
            height: 4px;
            transform: translateY(-50%);
            background: #808080;
            border-top: 1px solid #404040;
            border-left: 1px solid #404040;
            border-bottom: 1px solid #ffffff;
            border-right: 1px solid #ffffff;
        }

        .media-seek-thumb {
            position: absolute;
            top: 50%;
            transform: translate(-50%, -50%);
            width: 11px;
            height: 18px;
            background: #c0c0c0;
            border-top: 2px solid #ffffff;
            border-left: 2px solid #ffffff;
            border-bottom: 2px solid #808080;
            border-right: 2px solid #808080;
            cursor: pointer;
        }

        .media-controls {
            display: flex;
            justify-content: center;
            gap: 2px;
            padding: 4px 0;
        }

        .media-btn {
            width: 28px;
            height: 24px;
            background: #c0c0c0;
            border-top: 2px solid #ffffff;
            border-left: 2px solid #ffffff;
            border-bottom: 2px solid #808080;
            border-right: 2px solid #808080;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            color: #000;
        }

        .media-btn:hover {
            background: #d4d4d4;
        }

        .media-btn:active {
            border-top: 2px solid #808080;
            border-left: 2px solid #808080;
            border-bottom: 2px solid #ffffff;
            border-right: 2px solid #ffffff;
            padding-top: 2px;
            padding-left: 2px;
        }

        .media-btn.playing {
            border-top: 2px solid #808080;
            border-left: 2px solid #808080;
            border-bottom: 2px solid #ffffff;
            border-right: 2px solid #ffffff;
            background: #a0a0a0;
        }

        .media-volume-row {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 4px 0;
        }

        .media-volume-label {
            font-family: 'MS Sans Serif', 'Fixedsys', Tahoma, sans-serif;
            font-size: 11px;
            color: #000;
        }

        .media-volume {
            flex: 1;
            height: 20px;
            background: #c0c0c0;
            border-top: 2px solid #808080;
            border-left: 2px solid #808080;
            border-bottom: 2px solid #ffffff;
            border-right: 2px solid #ffffff;
            cursor: pointer;
            position: relative;
        }

        .media-volume-track {
            position: absolute;
            top: 50%;
            left: 4px;
            right: 4px;
            height: 4px;
            transform: translateY(-50%);
            background: #808080;
            border-top: 1px solid #404040;
            border-left: 1px solid #404040;
            border-bottom: 1px solid #ffffff;
            border-right: 1px solid #ffffff;
        }

        .media-volume-thumb {
            position: absolute;
            top: 50%;
            transform: translate(-50%, -50%);
            width: 11px;
            height: 18px;
            background: #c0c0c0;
            border-top: 2px solid #ffffff;
            border-left: 2px solid #ffffff;
            border-bottom: 2px solid #808080;
            border-right: 2px solid #808080;
            cursor: pointer;
        }

        .media-playlist {
            flex: 1;
            background: #fff;
            border: 2px inset #808080;
            overflow-y: auto;
            min-height: 50px;
            margin-top: 4px;
            font-family: 'MS Sans Serif', 'Fixedsys', Tahoma, sans-serif;
        }

        .media-playlist-header {
            background: #000080;
            color: #fff;
            font-size: 11px;
            padding: 2px 6px;
            font-family: 'MS Sans Serif', 'Fixedsys', Tahoma, sans-serif;
        }

        .media-playlist-item {
            padding: 2px 6px;
            font-size: 11px;
            color: #000;
            cursor: pointer;
            display: flex;
            gap: 6px;
            background: #ffffff;
        }

        .media-playlist-item:nth-child(odd) {
            background: #f0f0f0;
        }

        .media-playlist-item:hover {
            background: #000080;
            color: #ffffff;
        }

        .media-playlist-item.active {
            background: #000080;
            color: #ffffff;
        }

        .media-playlist-num {
            color: #808080;
            min-width: 18px;
            flex-shrink: 0;
        }

        .media-playlist-title {
            flex: 1;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .media-playlist-item.active .media-playlist-num,
        .media-playlist-item:hover .media-playlist-num {
            color: #c0c0c0;
        }

        .media-playlist-duration {
            margin-left: auto;
            color: #808080;
            text-align: right;
            flex-shrink: 0;
            min-width: 35px;
        }

        .media-playlist-item.active .media-playlist-duration,
        .media-playlist-item:hover .media-playlist-duration {
            color: #c0c0c0;
        }

        /* Mobile-friendly media player */
        @media (max-width: 600px) {
            .player-window {
                transform-origin: top left;
            }

            .player-window .media-player {
                padding: 8px;
            }

            .player-window .media-btn {
                width: 40px;
                height: 36px;
                font-size: 14px;
            }

            .player-window .media-seek,
            .player-window .media-volume {
                height: 28px;
            }

            .player-window .media-seek-thumb,
            .player-window .media-volume-thumb {
                width: 16px;
                height: 26px;
            }

            .player-window .media-playlist-item {
                padding: 6px 8px;
                font-size: 13px;
            }
        }

        @media (max-width: 768px) {
            body {
                font-size: 14px;
            }

            .desktop {
                height: calc(100vh - 40px);
            }

            .icon {
                width: 60px;
            }

            .icon-img {
                font-size: 28px;
            }

            .icon-label {
                font-size: 10px;
            }

            /* Make windows full screen on mobile */
            .window {
                width: 100% !important;
                height: calc(100vh - 40px) !important;
                left: 0 !important;
                top: 0 !important;
                min-width: 100%;
            }

            .window-content {
                padding: 15px;
                font-size: 14px;
            }

            .window-content h1 {
                font-size: 20px;
            }

            .window-content h2 {
                font-size: 16px;
            }

            /* Taskbar adjustments */
            .taskbar {
                height: 40px;
            }

            .start-btn {
                height: 36px;
                font-size: 14px;
            }

            .taskbar-item {
                height: 34px;
                font-size: 12px;
            }

            .system-tray {
                height: 34px;
                font-size: 12px;
            }

            /* Chat window */
            .chat-window .window-content {
                padding: 10px;
            }

            .chat-message {
                font-size: 12px;
                padding: 6px;
            }

            /* Winamp player adjustments */
            .player-window {
                min-width: 100% !important;
            }

            .winamp-btn {
                width: 32px;
                height: 26px;
                font-size: 12px;
            }

            .winamp-time {
                font-size: 24px;
            }

            .winamp-visualizer {
                width: 80px;
                height: 36px;
            }

            .winamp-playlist-item {
                font-size: 12px;
                padding: 6px 8px;
            }

            /* Start menu */
            .start-menu {
                width: 100%;
                left: 0;
            }

            /* Hide window drag on mobile (not useful on touch) */
            .title-bar {
                cursor: default;
            }

            /* Make toolbar buttons touch-friendly */
            .toolbar-btn {
                width: 32px;
                height: 30px;
            }

            /* Address bar */
            .address-bar {
                font-size: 12px;
            }
        }

        @media (max-width: 480px) {
            /* Extra small phones */
            .window-content {
                padding: 10px;
                font-size: 13px;
            }

            .menu-bar {
                font-size: 10px;
            }

            .toolbar {
                padding: 2px;
            }

            .toolbar-btn {
                width: 28px;
                height: 26px;
                font-size: 12px;
            }
        }

        /* Blog post styles */
        .post {
            font-family: Tahoma, 'MS Sans Serif', sans-serif;
            line-height: 1.7;
            font-size: 14px;
            color: #222;
            padding: 10px 20px 30px;
        }
        .post h1 {
            font-family: Tahoma, 'MS Sans Serif', sans-serif;
            font-size: 26px;
            margin: 0 0 8px 0;
            font-weight: bold;
            color: #000;
        }
        .post h2 {
            font-family: Tahoma, 'MS Sans Serif', sans-serif;
            font-size: 18px;
            margin: 1.2em 0 0.5em 0;
            color: #000;
        }
        .post .date {
            color: #999;
            font-family: Tahoma, 'MS Sans Serif', sans-serif;
            font-size: 11px;
            margin-top: 30px;
        }
        .post p {
            margin: 0 0 1.4em 0;
        }
        .post a {
            color: #0066cc;
            text-decoration: underline;
        }
        .post a:hover {
            color: #003d99;
        }
        .post a:visited {
            color: #551a8b;
        }
        .post blockquote {
            margin: 2.5em 0;
            padding: 20px 25px;
            border-left: 3px solid #0066cc;
            background: #f5f5f5;
            font-style: italic;
        }
        .post ol, .post ul {
            margin: 1em 0;
            margin-left: 0;
            padding-left: 3em;
        }
        .post ol li, .post ul li {
            margin-bottom: 0.6em;
            line-height: 1.6;
        }
        .post img {
            max-width: 100%;
            height: auto;
            margin: 1.5em 0;
            border: 1px solid #ccc;
        }
        .post code {
            font-family: 'Courier New', monospace;
            background: #f0f0f0;
            padding: 2px 6px;
            font-size: 15px;
        }
        .post pre {
            background: #f0f0f0;
            padding: 15px;
            overflow-x: auto;
            border: 1px solid #ccc;
            margin: 1.5em 0;
        }
        .post pre code {
            padding: 0;
            background: none;
        }
        .post-footer {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #ccc;
            font-family: Tahoma, 'MS Sans Serif', sans-serif;
            font-size: 14px;
            color: #666;
        }
        .post-footer a {
            color: #0066cc;
        }
    </style>
</head>
<body>
    <div class="desktop" id="desktop">
        <div class="icon" style="left: 10px; top: 10px;" onclick="openSubscribeDialog()">
            <div class="icon-img"><img src="icons/envelope_closed-0.png" alt="Newsletter"></div>
            <div class="icon-label">Newsletter</div>
        </div>
        <div class="icon" style="left: 10px; top: 100px;" onclick="openWindow('internet')">
            <div class="icon-img"><img src="icons/html-0.png" alt="Internet Explorer"></div>
            <div class="icon-label">Internet Explorer</div>
        </div>
        <div class="icon" style="left: 10px; top: 190px;" onclick="openWindow('chat')">
            <div class="icon-img"><img src="icons/message_tack-0.png" alt="Chat"></div>
            <div class="icon-label">Chat</div>
        </div>
        <div class="icon" style="left: 10px; top: 280px;" onclick="openWindow('player')">
            <div class="icon-img"><img src="icons/loudspeaker_rays-0.png" alt="Winamp"></div>
            <div class="icon-label">Winamp</div>
        </div>
        <div class="icon" style="left: 10px; top: 370px;" onclick="openWindow('applications')">
            <div class="icon-img"><img src="icons/directory_closed-0.png" alt="Applications"></div>
            <div class="icon-label">Applications</div>
        </div>
        <div class="desktop-watermark">made with <span style="color: #ff0000;">‚ô•</span> in seattle</div>
    </div>

    <!-- Internet Explorer Window -->
    <div class="window" id="internet" style="width: 620px; height: 750px; left: 380px; top: 15px;">
        <div class="title-bar" onmousedown="dragStart(event, 'internet')">
            <div class="title-text">
                <div class="title-icon"><img src="icons/html-1.png" alt=""></div>
                <span>Santi's Blog - Internet Explorer</span>
            </div>
            <div class="title-buttons">
                <div class="title-btn" onclick="minimizeWindow('internet')">_</div>
                <div class="title-btn">‚ñ°</div>
                <div class="title-btn" onclick="closeWindow('internet')">‚úï</div>
            </div>
        </div>
        <div class="menu-bar">
            <span class="menu-item">File</span>
            <span class="menu-item">Edit</span>
            <span class="menu-item">View</span>
            <span class="menu-item">Favorites</span>
            <span class="menu-item">Tools</span>
            <span class="menu-item">Help</span>
        </div>
        <div class="toolbar">
            <div class="toolbar-btn" onclick="goBack()">‚Üê</div>
            <div class="toolbar-btn" onclick="goForward()">‚Üí</div>
            <div class="toolbar-btn" onclick="stopLoading()">‚úï</div>
            <div class="toolbar-btn" onclick="refreshPage()">‚Üª</div>
            <div class="toolbar-btn" onclick="loadHome()">üè†</div>
        </div>
        <div class="address-bar">Address: https://santi.wtf</div>
        <div class="window-content" id="blog-content">
            <!-- Content loads here dynamically -->
        </div>
        <div class="resize-handle" onmousedown="resizeStart(event, 'internet')"></div>
    </div>

    <!-- Chat Room Window -->
    <div class="window chat-window" id="chat" style="width: 380px; height: 500px; left: 450px; top: 100px;">
        <div class="title-bar" onmousedown="dragStart(event, 'chat')">
            <div class="title-text">
                <div class="title-icon"><img src="icons/message_tack-1.png" alt=""></div>
                <span>santi's chat room</span>
            </div>
            <div class="title-buttons">
                <div class="title-btn" onclick="minimizeWindow('chat')">_</div>
                <div class="title-btn">‚ñ°</div>
                <div class="title-btn" onclick="closeWindow('chat')">‚úï</div>
            </div>
        </div>
        <div class="window-content">
            <!-- Admin Panel (hidden until admin mode) -->
            <div class="chat-admin-panel">
                <div class="chat-admin-title">admin controls</div>
                <div class="chat-admin-row chat-admin-status-row">
                    <select id="admin-status-type" class="chat-admin-status-select">
                        <option value="online">online</option>
                        <option value="away">away</option>
                    </select>
                    <input type="text" id="admin-status-message" class="chat-admin-input" placeholder="status message...">
                    <button type="button" class="chat-admin-btn" onclick="updateStatus()">set</button>
                </div>
                <div class="chat-admin-row">
                    <input type="text" id="admin-chat-message" class="chat-admin-input" placeholder="post as santi...">
                    <button type="button" class="chat-admin-btn" onclick="postAsOwner()">send</button>
                </div>
            </div>

            <!-- Status Box -->
            <div class="chat-status-box">
                <div class="chat-status-indicator online" id="status-indicator"></div>
                <div class="chat-status-content">
                    <div class="chat-status-name">santi</div>
                    <div class="chat-status-message" id="status-message">welcome to my corner of the internet</div>
                    <div class="chat-status-lastseen" id="status-lastseen">last seen: just now</div>
                </div>
            </div>

            <!-- Chat Messages -->
            <div class="chat-messages" id="chat-messages">
                <div style="text-align: center; color: #666; padding: 20px;">loading messages...</div>
            </div>

            <!-- Chat Input -->
            <div class="chat-input-area">
                <form class="chat-input-form" id="chat-form" onsubmit="return false;">
                    <input type="text" class="chat-input-name" id="chat-name" placeholder="name">
                    <input type="text" class="chat-input-message" id="chat-message" placeholder="say something..." onkeypress="if(event.key==='Enter'){submitChat();return false;}">
                    <button type="button" class="chat-input-send" onclick="submitChat()">send</button>
                </form>
            </div>
        </div>
        <div class="resize-handle" onmousedown="resizeStart(event, 'chat')"></div>
    </div>

    <!-- Winamp Player Window -->
    <div class="window player-window" id="player" style="width: 280px; height: 300px; left: 200px; top: 200px;">
        <div class="title-bar" onmousedown="dragStart(event, 'player')">
            <div class="title-text">
                <div class="title-icon"><img src="icons/loudspeaker_rays-1.png" alt=""></div>
                <span>Winamp</span>
            </div>
            <div class="title-buttons">
                <div class="title-btn" onclick="minimizeWindow('player')">_</div>
                <div class="title-btn">‚ñ°</div>
                <div class="title-btn" onclick="closeWindow('player')">‚úï</div>
            </div>
        </div>
        <div class="window-content">
            <div class="media-player">
                <!-- Display with visualizer -->
                <div class="media-display">
                    <div class="media-visualizer" id="media-visualizer">
                        <div class="viz-bar" style="height: 20%"></div>
                        <div class="viz-bar" style="height: 35%"></div>
                        <div class="viz-bar" style="height: 50%"></div>
                        <div class="viz-bar" style="height: 40%"></div>
                        <div class="viz-bar" style="height: 60%"></div>
                        <div class="viz-bar" style="height: 45%"></div>
                        <div class="viz-bar" style="height: 30%"></div>
                        <div class="viz-bar" style="height: 55%"></div>
                        <div class="viz-bar" style="height: 25%"></div>
                        <div class="viz-bar" style="height: 15%"></div>
                        <div class="viz-bar" style="height: 40%"></div>
                        <div class="viz-bar" style="height: 50%"></div>
                        <div class="viz-bar" style="height: 35%"></div>
                        <div class="viz-bar" style="height: 45%"></div>
                        <div class="viz-bar" style="height: 20%"></div>
                    </div>
                    <div class="media-info">
                        <div class="media-ticker">
                            <span class="media-ticker-text paused" id="media-ticker">Esperanza - Hermanos Guti√©rrez</span>
                        </div>
                        <div class="media-time" id="media-time">0:00</div>
                    </div>
                </div>

                <!-- Seek Bar -->
                <div class="media-seek-row">
                    <div class="media-seek" id="media-seek" onclick="seekTo(event)">
                        <div class="media-seek-track"></div>
                        <div class="media-seek-thumb" id="media-seek-thumb" style="left: 4px;"></div>
                    </div>
                </div>

                <!-- Transport Controls -->
                <div class="media-controls">
                    <div class="media-btn" onclick="prevTrack()" title="Previous">‚èÆ</div>
                    <div class="media-btn" id="playBtn" onclick="mediaPlay()" title="Play">‚ñ∂</div>
                    <div class="media-btn" onclick="mediaPause()" title="Pause">‚è∏</div>
                    <div class="media-btn" onclick="mediaStop()" title="Stop">‚èπ</div>
                    <div class="media-btn" onclick="nextTrack()" title="Next">‚è≠</div>
                </div>

                <!-- Volume -->
                <div class="media-volume-row">
                    <span class="media-volume-label">VOL</span>
                    <div class="media-volume" onclick="setVolume(event)">
                        <div class="media-volume-track"></div>
                        <div class="media-volume-thumb" id="media-volume-thumb" style="left: 80%;"></div>
                    </div>
                </div>
            </div>

            <!-- Playlist -->
            <div class="media-playlist" id="media-playlist">
                <div class="media-playlist-header">Playlist</div>
            </div>

            <audio id="audioPlayer">
                <source src="vibes/Esperanza.mp3" type="audio/mpeg">
            </audio>
        </div>
        <div class="resize-handle" onmousedown="resizeStart(event, 'player')"></div>
    </div>

    <!-- My Computer Window -->
    <div class="window" id="mycomputer" style="width: 400px; height: 350px; left: 100px; top: 80px;">
        <div class="title-bar" onmousedown="dragStart(event, 'mycomputer')">
            <div class="title-text">
                <div class="title-icon"><img src="icons/computer_explorer-1.png" alt=""></div>
                <span>My Computer</span>
            </div>
            <div class="title-buttons">
                <div class="title-btn" onclick="minimizeWindow('mycomputer')">_</div>
                <div class="title-btn">‚ñ°</div>
                <div class="title-btn" onclick="closeWindow('mycomputer')">‚úï</div>
            </div>
        </div>
        <div class="window-content" style="display: flex; flex-wrap: wrap; gap: 20px; padding: 20px; background: #fff;">
            <div style="text-align: center; width: 70px; cursor: pointer;">
                <div class="icon-img"><img src="icons/floppy_drive_3_5-0.png" alt=""></div>
                <div style="font-size: 11px; margin-top: 4px;">3¬Ω Floppy (A:)</div>
            </div>
            <div style="text-align: center; width: 70px; cursor: pointer;">
                <div class="icon-img"><img src="icons/hard_disk_drive-0.png" alt=""></div>
                <div style="font-size: 11px; margin-top: 4px;">(C:)</div>
            </div>
            <div style="text-align: center; width: 70px; cursor: pointer;">
                <div class="icon-img"><img src="icons/cd_drive-0.png" alt=""></div>
                <div style="font-size: 11px; margin-top: 4px;">(D:)</div>
            </div>
            <div style="text-align: center; width: 70px; cursor: pointer;">
                <div class="icon-img"><img src="icons/printer-0.png" alt=""></div>
                <div style="font-size: 11px; margin-top: 4px;">Printers</div>
            </div>
            <div style="text-align: center; width: 70px; cursor: pointer;">
                <div class="icon-img"><img src="icons/directory_control_panel-0.png" alt=""></div>
                <div style="font-size: 11px; margin-top: 4px;">Control Panel</div>
            </div>
        </div>
        <div class="resize-handle" onmousedown="resizeStart(event, 'mycomputer')"></div>
    </div>

    <!-- Applications Folder Window -->
    <div class="window" id="applications" style="width: 400px; height: 300px; left: 150px; top: 120px;">
        <div class="title-bar" onmousedown="dragStart(event, 'applications')">
            <div class="title-text">
                <div class="title-icon"><img src="icons/directory_closed-1.png" alt=""></div>
                <span>Applications</span>
            </div>
            <div class="title-buttons">
                <div class="title-btn" onclick="minimizeWindow('applications')">_</div>
                <div class="title-btn">‚ñ°</div>
                <div class="title-btn" onclick="closeWindow('applications')">‚úï</div>
            </div>
        </div>
        <div class="window-content" style="height: calc(100% - 24px); display: flex; flex-wrap: wrap; gap: 20px; padding: 20px; align-content: flex-start;">
            <div class="icon" style="position: static;" onclick="openWindow('flowgarden')">
                <div class="icon-img"><img src="icons/tree-0.png" alt=""></div>
                <div class="icon-label" style="color: #000; text-shadow: none;">Flow Garden</div>
            </div>
            <div class="icon" style="position: static;" onclick="openWindow('stickynotes')">
                <div class="icon-img"><img src="icons/note-0.png" alt=""></div>
                <div class="icon-label" style="color: #000; text-shadow: none;">Sticky Notes</div>
            </div>
        </div>
        <div class="resize-handle" onmousedown="resizeStart(event, 'applications')"></div>
    </div>

    <!-- Sticky Notes Window -->
    <div class="window" id="stickynotes" style="width: 550px; height: 420px; left: 200px; top: 80px;">
        <div class="title-bar" onmousedown="dragStart(event, 'stickynotes')">
            <div class="title-text">
                <div class="title-icon"><img src="icons/note-1.png" alt=""></div>
                <span>Sticky Notes</span>
            </div>
            <div class="title-buttons">
                <div class="title-btn" onclick="minimizeWindow('stickynotes')">_</div>
                <div class="title-btn">‚ñ°</div>
                <div class="title-btn" onclick="closeWindow('stickynotes')">‚úï</div>
            </div>
        </div>
        <div class="window-content" id="stickynotes-content" style="height: calc(100% - 24px); padding: 0; overflow: hidden;">
            <!-- Content loads here dynamically -->
        </div>
        <div class="resize-handle" onmousedown="resizeStart(event, 'stickynotes')"></div>
    </div>

    <!-- Flow Garden Window -->
    <div class="window" id="flowgarden" style="width: 720px; height: 520px; left: 120px; top: 50px;">
        <div class="title-bar" onmousedown="dragStart(event, 'flowgarden')">
            <div class="title-text">
                <div class="title-icon"><img src="icons/tree-1.png" alt=""></div>
                <span>Flow Garden</span>
            </div>
            <div class="title-buttons">
                <div class="title-btn" onclick="minimizeWindow('flowgarden')">_</div>
                <div class="title-btn">‚ñ°</div>
                <div class="title-btn" onclick="closeWindow('flowgarden')">‚úï</div>
            </div>
        </div>
        <div class="window-content" id="flowgarden-content" style="height: calc(100% - 24px);">
            <!-- Content loads here dynamically -->
        </div>
        <div class="resize-handle" onmousedown="resizeStart(event, 'flowgarden')"></div>
    </div>

    <!-- Taskbar -->
    <div class="taskbar">
        <div class="start-btn" onclick="toggleStartMenu()">
            <div class="start-icon"><img src="icons/windows-0.png" alt="" style="width: 16px; height: 16px; image-rendering: pixelated;"></div>
            <span>Start</span>
        </div>
        <div class="taskbar-items" id="taskbar-items"></div>
        <div class="system-tray">
            <span>üîä</span>
            <span id="clock">7:08 PM</span>
        </div>
    </div>

    <!-- Start Menu -->
    <div class="start-menu" id="start-menu">
        <div class="start-menu-header">santi.wtf</div>
        <div class="start-menu-item" onclick="openWindow('internet')"><img src="icons/html-1.png" alt="">Internet Explorer</div>
        <div class="start-menu-item" onclick="openWindow('chat')"><img src="icons/message_tack-1.png" alt="">Chat</div>
        <div class="start-menu-item" onclick="openWindow('player')"><img src="icons/loudspeaker_rays-1.png" alt="">Winamp</div>
        <div class="start-menu-item" onclick="openWindow('applications')"><img src="icons/directory_closed-1.png" alt="">Applications</div>
        <div style="border-top: 1px solid #808080; margin: 2px 0;"></div>
        <div class="start-menu-item" onclick="openShutdownDialog()"><img src="icons/shut_down_normal-1.png" alt="">Shut Down...</div>
    </div>

    <!-- Clippy Assistant -->
    <div class="clippy-container" id="clippy">
        <div class="clippy-bubble">
            <span class="clippy-close" onclick="dismissClippy()">&times;</span>
            <p>It looks like you're enjoying the site! Want to get my latest posts in your inbox?</p>
            <div class="clippy-buttons">
                <button class="clippy-btn primary" onclick="clippySubscribe()">Sure!</button>
                <button class="clippy-btn" onclick="dismissClippy()">No thanks</button>
            </div>
        </div>
        <div class="clippy-character" onclick="toggleClippyBubble()"><img src="icons/msagent-4.png" alt="" style="width: 48px; height: 48px; image-rendering: pixelated;"></div>
    </div>

    <!-- Shut Down Dialog (Newsletter Easter Egg) -->
    <div class="shutdown-overlay" id="shutdown-overlay" onclick="closeShutdownDialog(event)">
        <div class="shutdown-dialog" onclick="event.stopPropagation()">
            <div class="title-bar">
                <div class="title-text">
                    <div class="title-icon" id="subscribe-dialog-icon"><img src="icons/shut_down_normal-1.png" alt=""></div>
                    <span id="subscribe-dialog-title">Shut Down</span>
                </div>
                <div class="title-buttons">
                    <div class="title-btn" onclick="closeShutdownDialog()">‚úï</div>
                </div>
            </div>
            <div class="shutdown-content">
                <p id="subscribe-message"><strong>Wait! Before you go...</strong><br>Subscribe to get my latest thoughts delivered straight to your inbox.</p>
                <iframe
                    src="https://subscribe-forms.beehiiv.com/31d4bffd-241f-42e3-82b3-6d084ef26221"
                    class="beehiiv-embed"
                    data-test-id="beehiiv-embed"
                    frameborder="0"
                    scrolling="no"
                    style="height: 40px;">
                </iframe>
                <div class="shutdown-buttons">
                    <button class="shutdown-btn" onclick="closeShutdownDialog()">Maybe Later</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let activeWindow = null;
        let draggedWindow = null;
        let offsetX = 0;
        let offsetY = 0;

        // Resize variables
        let resizedWindow = null;
        let startX = 0;
        let startY = 0;
        let startWidth = 0;
        let startHeight = 0;

        // Track minimized and open windows
        const minimizedWindows = new Set();
        const openWindows = new Set();

        function openWindow(id) {
            const win = document.getElementById(id);
            win.style.display = 'block';
            openWindows.add(id);
            minimizedWindows.delete(id);
            setActiveWindow(id);
            updateTaskbar();
            closeStartMenu();

            // Load content for app windows
            if (id === 'flowgarden') {
                loadFlowGarden();
            } else if (id === 'stickynotes') {
                loadStickyNotes();
            }
        }

        function minimizeWindow(id) {
            const win = document.getElementById(id);
            win.style.display = 'none';
            minimizedWindows.add(id);
            win.classList.remove('active');
            activeWindow = null;
            updateTaskbar();
        }

        function restoreWindow(id) {
            const win = document.getElementById(id);
            win.style.display = 'block';
            minimizedWindows.delete(id);
            setActiveWindow(id);
            updateTaskbar();
        }

        function closeWindow(id) {
            const win = document.getElementById(id);
            win.style.display = 'none';
            openWindows.delete(id);
            minimizedWindows.delete(id);
            updateTaskbar();

            // Stop music when closing Winamp
            if (id === 'player') {
                winampStop();
            }
        }

        function setActiveWindow(id) {
            document.querySelectorAll('.window').forEach(w => w.classList.remove('active'));
            const win = document.getElementById(id);
            win.classList.add('active');
            activeWindow = id;
        }

        function updateTaskbar() {
            const container = document.getElementById('taskbar-items');
            container.innerHTML = '';

            document.querySelectorAll('.window').forEach(win => {
                const isVisible = win.style.display === 'block';
                const isMinimized = minimizedWindows.has(win.id);

                if (isVisible || isMinimized) {
                    const item = document.createElement('div');
                    item.className = 'taskbar-item';
                    if (win.classList.contains('active')) item.classList.add('active');

                    // Get icon and title
                    const icon = win.querySelector('.title-icon').textContent;
                    let title = win.querySelector('.title-text span').textContent;

                    // Truncate long titles
                    const maxLength = 15;
                    if (title.length > maxLength) {
                        title = title.substring(0, maxLength) + '...';
                    }

                    item.innerHTML = `<span style="margin-right: 4px;">${icon}</span>${title}`;

                    item.onclick = () => {
                        if (minimizedWindows.has(win.id)) {
                            restoreWindow(win.id);
                        } else {
                            setActiveWindow(win.id);
                        }
                    };
                    container.appendChild(item);
                }
            });
        }

        function toggleStartMenu() {
            document.getElementById('start-menu').classList.toggle('open');
        }

        function closeStartMenu() {
            document.getElementById('start-menu').classList.remove('open');
        }

        // Shut Down Dialog (Newsletter Easter Egg)
        const subscribeMessages = {
            shutdown: "<strong>Wait! Before you go...</strong><br>Subscribe to get my latest thoughts delivered straight to your inbox.",
            clippy: "<strong>Great choice!</strong><br>Enter your email to get my latest posts.",
            newsletter: "<strong>Stay connected</strong><br>Get my latest posts delivered straight to your inbox."
        };

        function openShutdownDialog(source = 'shutdown') {
            closeStartMenu();
            document.getElementById('subscribe-message').innerHTML = subscribeMessages[source];
            document.getElementById('subscribe-dialog-title').textContent = source === 'shutdown' ? 'Shut Down' : 'Newsletter';
            document.getElementById('subscribe-dialog-icon').innerHTML = source === 'shutdown'
                ? '<img src="icons/shut_down_normal-1.png" alt="">'
                : '<img src="icons/envelope_closed-1.png" alt="">';
            document.getElementById('shutdown-overlay').classList.add('open');
        }

        function openSubscribeDialog() {
            openShutdownDialog('newsletter');
        }

        function closeShutdownDialog(event) {
            // If called from overlay click, only close if clicking the overlay itself
            if (event && event.currentTarget && event.target !== event.currentTarget) return;
            document.getElementById('shutdown-overlay').classList.remove('open');
        }

        // Clippy Assistant
        let clippyDismissed = sessionStorage.getItem('clippyDismissed');
        let clippyBubbleVisible = true;

        function initClippy() {
            if (clippyDismissed) return;

            // Show Clippy after 15 seconds
            setTimeout(() => {
                document.getElementById('clippy').classList.add('show');
            }, 15000);
        }

        function dismissClippy() {
            document.getElementById('clippy').classList.remove('show');
            sessionStorage.setItem('clippyDismissed', 'true');
            clippyDismissed = true;
        }

        function toggleClippyBubble() {
            const bubble = document.querySelector('.clippy-bubble');
            clippyBubbleVisible = !clippyBubbleVisible;
            bubble.style.display = clippyBubbleVisible ? 'block' : 'none';
        }

        function clippySubscribe() {
            dismissClippy();
            openShutdownDialog('clippy');
        }

        // Initialize Clippy on page load
        document.addEventListener('DOMContentLoaded', initClippy);

        function dragStart(e, id) {
            draggedWindow = document.getElementById(id);
            setActiveWindow(id);
            
            const rect = draggedWindow.getBoundingClientRect();
            offsetX = e.clientX - rect.left;
            offsetY = e.clientY - rect.top;
            
            document.addEventListener('mousemove', drag);
            document.addEventListener('mouseup', dragEnd);
        }

        function drag(e) {
            if (!draggedWindow) return;
            
            const x = e.clientX - offsetX;
            const y = e.clientY - offsetY;
            
            draggedWindow.style.left = Math.max(0, x) + 'px';
            draggedWindow.style.top = Math.max(0, y) + 'px';
        }

        function dragEnd() {
            draggedWindow = null;
            document.removeEventListener('mousemove', drag);
            document.removeEventListener('mouseup', dragEnd);
        }

        // Window resize functions
        function resizeStart(e, id) {
            e.stopPropagation();
            resizedWindow = document.getElementById(id);
            setActiveWindow(id);
            
            startX = e.clientX;
            startY = e.clientY;
            startWidth = resizedWindow.offsetWidth;
            startHeight = resizedWindow.offsetHeight;
            
            document.addEventListener('mousemove', resize);
            document.addEventListener('mouseup', resizeEnd);
        }

        function resize(e) {
            if (!resizedWindow) return;
            
            const width = startWidth + (e.clientX - startX);
            const height = startHeight + (e.clientY - startY);
            
            // Enforce minimum sizes
            if (width >= 400) {
                resizedWindow.style.width = width + 'px';
            }
            if (height >= 200) {
                resizedWindow.style.height = height + 'px';
            }
        }

        function resizeEnd() {
            resizedWindow = null;
            document.removeEventListener('mousemove', resize);
            document.removeEventListener('mouseup', resizeEnd);
        }

        // Click outside start menu to close
        document.addEventListener('click', (e) => {
            if (!e.target.closest('.start-btn') && !e.target.closest('.start-menu')) {
                closeStartMenu();
            }
        });

        // Browser history for navigation
        let browserHistory = [];
        let historyPosition = -1;

        // Store the home content
        const homeContent = `
            <div class="post">
                <h1>santi.wtf</h1>
                <p style="text-align: center; margin-bottom: 20px;">
                    <a href="#" onclick="loadPost('now.html'); return false;">now</a> | <a href="#" onclick="loadArchive(); return false;">notes</a> | <a href="https://mail.0ffbrand.com" target="_blank">newsletter</a>
                </p>
                <h2>welcome, friend. shoes off, please.</h2>
                <p>i built this site because i miss the internet. the one before the apps. i miss the weird little corners of the web where people shared their thoughts, art, and creativity freely. the internet before social media algorithms.</p>
                <p>i miss that internet.</p>
                <p>so i made a little corner of my own to share my thoughts, feelings, and projects. away from all the noise. away from algorithms, gurus, and ads. just me, my words, and now, you.</p>
                <p>a little bit about me: i'm santi ‚Äî i study the greatest creative minds, run a <a href="https://mail.0ffbrand.com" target="_blank">weekly letter</a> about them, and spend my days slinging software. when i'm not working, you'll find me reading, <a href="#" onclick="loadArchive(); return false;">writing</a>, or <a href="https://link.chess.com/friend/tVW5eb" target="_blank">pushing pawns</a>.</p>
                <p>enjoy your stay, and come back soon ‚Äî and as often as you'd like. don't forget to say hi in the <a href="#" onclick="openWindow('chat'); return false;">chat</a> on your way out.</p>
                <p>p.s. even though the site works pretty well on mobile, you'll have a lot more fun viewing it on your computer.</p>
                <p style="font-family: monospace; margin-top: 1.5em;">&lt;3 <a href="mailto:yosawnts@gmail.com">santi</a></p>
            </div>
        `;

        // Archive content
        const archiveContent = `
            <div class="post">
                <h1>santi.wtf</h1>
                <p style="text-align: center; margin-bottom: 20px;">
                    <a href="#" onclick="loadPost('now.html'); return false;">now</a> | <a href="#" onclick="loadArchive(); return false;">notes</a> | <a href="https://mail.0ffbrand.com" target="_blank">newsletter</a>
                </p>

                <h2>notes</h2>
                <p>on creativity, philosophy, business, and life.</p>

                <h3 style="margin-top: 30px;">2026</h3>
                <ul>
                    <li><a href="#" onclick="loadPost('posts/power-of-writing-online.html'); return false;">10 reasons why you should start writing online</a></li>
                    <li><a href="#" onclick="loadPost('posts/favorite-reads-2025.html'); return false;">my favorite reads of 2025</a></li>
                </ul>
            </div>
        `;

        // Load home content
        function loadHome(updateHash = true) {
            const content = document.getElementById('blog-content');
            if (content) {
                content.innerHTML = homeContent;
                content.scrollTop = 0;

                // Update URL hash
                if (updateHash) {
                    history.pushState(null, '', window.location.pathname);
                    updateAddressBar('https://santi.wtf');
                }

                // Add to history
                addToHistory('home', homeContent);
            }
        }

        // Load archive page
        function loadArchive(updateHash = true) {
            const content = document.getElementById('blog-content');
            if (content) {
                content.innerHTML = archiveContent;
                content.scrollTop = 0;

                // Update URL hash
                if (updateHash) {
                    history.pushState(null, '', '#archive');
                    updateAddressBar('https://santi.wtf/archive');
                }

                // Add to history
                addToHistory('archive', archiveContent);
            }
        }

        // Update address bar display
        function updateAddressBar(url) {
            const addressBar = document.querySelector('.address-bar');
            if (addressBar) {
                addressBar.textContent = 'Address: ' + url;
            }
        }

        // Load Flow Garden content
        async function loadFlowGarden() {
            const content = document.getElementById('flowgarden-content');
            if (!content || content.dataset.loaded === 'true') return;

            try {
                const response = await fetch('applications/flowgarden.html');
                const html = await response.text();

                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');
                const body = doc.querySelector('body');
                const styles = doc.querySelectorAll('style');
                const scripts = doc.querySelectorAll('script');

                if (body) {
                    // Inject styles first, then body content
                    let styleHTML = '';
                    styles.forEach(style => { styleHTML += style.outerHTML; });
                    content.innerHTML = styleHTML + body.innerHTML;

                    // Execute scripts manually (innerHTML doesn't execute scripts)
                    scripts.forEach(oldScript => {
                        const newScript = document.createElement('script');
                        newScript.textContent = oldScript.textContent;
                        content.appendChild(newScript);
                    });

                    content.dataset.loaded = 'true';
                }
            } catch (error) {
                content.innerHTML = '<p>Error loading Flow Garden.</p>';
                console.error('Error loading Flow Garden:', error);
            }
        }

        // Load Sticky Notes content
        async function loadStickyNotes() {
            const content = document.getElementById('stickynotes-content');
            if (!content || content.dataset.loaded === 'true') return;

            try {
                const response = await fetch('applications/stickynotes.html');
                const html = await response.text();

                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');
                const body = doc.querySelector('body');
                const styles = doc.querySelectorAll('style');
                const scripts = doc.querySelectorAll('script');

                if (body) {
                    let styleHTML = '';
                    styles.forEach(style => { styleHTML += style.outerHTML; });
                    content.innerHTML = styleHTML + body.innerHTML;

                    scripts.forEach(oldScript => {
                        const newScript = document.createElement('script');
                        newScript.textContent = oldScript.textContent;
                        content.appendChild(newScript);
                    });

                    content.dataset.loaded = 'true';
                }
            } catch (error) {
                content.innerHTML = '<p>Error loading Sticky Notes.</p>';
                console.error('Error loading Sticky Notes:', error);
            }
        }

        // Load a blog post
        async function loadPost(url, updateHash = true) {
            const content = document.getElementById('blog-content');
            if (!content) return;

            try {
                const response = await fetch(url);
                const html = await response.text();

                // Extract styles and body content from the post
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');
                const styles = doc.querySelectorAll('style');
                const body = doc.querySelector('body');

                if (body) {
                    // Replace "back to desktop" links with "back to home" that works in-window
                    let postContent = '';

                    // Add styles first
                    styles.forEach(style => { postContent += style.outerHTML; });

                    // Add body content
                    postContent += body.innerHTML;
                    postContent = postContent.replace(/‚Üê back to desktop/g, '‚Üê back to home');
                    postContent = postContent.replace(/href="\.\.\/index\.html"/g, 'href="#" onclick="loadHome(); return false;"');

                    content.innerHTML = postContent;
                    content.scrollTop = 0;

                    // Update URL hash
                    if (updateHash) {
                        // Handle root-level pages vs posts
                        if (url === 'now.html') {
                            history.pushState(null, '', '#now');
                            updateAddressBar('https://santi.wtf/now');
                        } else {
                            history.pushState(null, '', '#' + url);
                            const postName = url.replace('posts/', '').replace('.html', '');
                            updateAddressBar('https://santi.wtf/' + postName);
                        }
                    }

                    // Add to history
                    addToHistory(url, postContent);
                } else {
                    content.innerHTML = '<p>Error loading post.</p>';
                }
            } catch (error) {
                content.innerHTML = '<p>Error loading post. Make sure the file exists in the posts folder.</p>';
                console.error('Error loading post:', error);
            }
        }

        // Add page to browser history
        function addToHistory(url, content) {
            // If we're not at the end of history, remove everything after current position
            if (historyPosition < browserHistory.length - 1) {
                browserHistory = browserHistory.slice(0, historyPosition + 1);
            }
            
            browserHistory.push({ url, content });
            historyPosition = browserHistory.length - 1;
        }

        // Navigate back
        function goBack() {
            if (historyPosition > 0) {
                historyPosition--;
                const page = browserHistory[historyPosition];
                const content = document.getElementById('blog-content');
                if (content) {
                    content.innerHTML = page.content;
                    content.scrollTop = 0;
                    updateHashForPage(page.url);
                }
            }
        }

        // Navigate forward
        function goForward() {
            if (historyPosition < browserHistory.length - 1) {
                historyPosition++;
                const page = browserHistory[historyPosition];
                const content = document.getElementById('blog-content');
                if (content) {
                    content.innerHTML = page.content;
                    content.scrollTop = 0;
                    updateHashForPage(page.url);
                }
            }
        }

        // Update hash based on page type
        function updateHashForPage(pageUrl) {
            if (pageUrl === 'home') {
                history.replaceState(null, '', window.location.pathname);
                updateAddressBar('https://santi.wtf');
            } else if (pageUrl === 'archive') {
                history.replaceState(null, '', '#archive');
                updateAddressBar('https://santi.wtf/archive');
            } else if (pageUrl === 'now.html') {
                history.replaceState(null, '', '#now');
                updateAddressBar('https://santi.wtf/now');
            } else {
                history.replaceState(null, '', '#' + pageUrl);
                const postName = pageUrl.replace('posts/', '').replace('.html', '');
                updateAddressBar('https://santi.wtf/' + postName);
            }
        }

        // Stop loading (placeholder for now)
        function stopLoading() {
            // In a real browser this would stop page loading
            // For now, just a visual feedback
            console.log('Stop loading');
        }

        // Refresh current page
        function refreshPage() {
            if (historyPosition >= 0 && browserHistory[historyPosition]) {
                const page = browserHistory[historyPosition];
                if (page.url === 'home') {
                    loadHome();
                    historyPosition--; // loadHome adds to history, so adjust
                } else if (page.url === 'archive') {
                    loadArchive();
                    historyPosition--;
                } else {
                    loadPost(page.url);
                    historyPosition--;
                }
            } else {
                loadHome();
            }
        }

        // Handle hash-based routing
        function handleRoute() {
            const hash = window.location.hash.slice(1); // Remove the #

            if (!hash || hash === '') {
                loadHome(false);
            } else if (hash === 'archive') {
                loadArchive(false);
            } else if (hash === 'now') {
                loadPost('now.html', false);
            } else if (hash.startsWith('posts/')) {
                loadPost(hash, false);
            } else {
                // Unknown route, go home
                loadHome(false);
            }
        }

        // Listen for browser back/forward navigation
        window.addEventListener('popstate', handleRoute);

        // Open IE on load and route based on URL hash
        window.onload = () => {
            openWindow('internet');
            handleRoute(); // Load page based on URL hash
            updateClock(); // Set initial time
            setInterval(updateClock, 1000); // Update every second
        };

        // Update the clock
        function updateClock() {
            const now = new Date();
            let hours = now.getHours();
            const minutes = now.getMinutes().toString().padStart(2, '0');
            const ampm = hours >= 12 ? 'PM' : 'AM';
            
            hours = hours % 12;
            hours = hours ? hours : 12; // 0 should be 12
            
            const timeString = `${hours}:${minutes} ${ampm}`;
            document.getElementById('clock').textContent = timeString;
        }

        // ==========================================
        // MEDIA PLAYER
        // ==========================================

        const playlist = [
            { title: 'Esperanza', artist: 'Hermanos Guti√©rrez', src: 'vibes/Esperanza.mp3' },
            { title: 'Community', artist: 'JID ft. Clipse', src: 'vibes/Community.mp3' },
            { title: 'WASH', artist: 'Jon Bellion', src: 'vibes/WASH.mp3' },
            { title: 'Folded', artist: 'Kehlani', src: 'vibes/Folded.mp3' }
        ];

        let currentTrack = 0;
        let isPlaying = false;
        let vizInterval = null;

        const audio = document.getElementById('audioPlayer');
        const playBtn = document.getElementById('playBtn');
        const mediaTime = document.getElementById('media-time');
        const mediaSeekThumb = document.getElementById('media-seek-thumb');
        const mediaTicker = document.getElementById('media-ticker');
        const mediaVolumeThumb = document.getElementById('media-volume-thumb');
        const mediaVisualizer = document.getElementById('media-visualizer');
        const playlistContainer = document.getElementById('media-playlist');

        function initMediaPlayer() {
            audio.volume = 0.8;
            mediaVolumeThumb.style.left = '80%';
            renderPlaylist();
            loadTrack(0);
            audio.addEventListener('timeupdate', updateTimeDisplay);
            audio.addEventListener('ended', nextTrack);
            audio.addEventListener('loadedmetadata', updatePlaylistDurations);
        }

        function renderPlaylist() {
            const header = playlistContainer.querySelector('.media-playlist-header');
            playlistContainer.innerHTML = '';
            playlistContainer.appendChild(header);
            playlist.forEach((track, index) => {
                const item = document.createElement('div');
                item.className = 'media-playlist-item' + (index === currentTrack ? ' active' : '');
                item.innerHTML = `
                    <span class="media-playlist-num">${index + 1}.</span>
                    <span class="media-playlist-title">${track.artist} - ${track.title}</span>
                    <span class="media-playlist-duration" id="duration-${index}">--:--</span>
                `;
                item.onclick = () => { loadTrack(index); mediaPlay(); };
                playlistContainer.appendChild(item);
            });
        }

        function loadTrack(index) {
            if (index < 0 || index >= playlist.length) return;
            currentTrack = index;
            const track = playlist[currentTrack];
            audio.src = track.src;
            mediaTicker.textContent = `${track.artist} - ${track.title}`;
            document.querySelectorAll('.media-playlist-item').forEach((item, i) => {
                item.classList.toggle('active', i === currentTrack);
            });
            mediaTime.textContent = '0:00';
            mediaSeekThumb.style.left = '4px';
        }

        function updatePlaylistDurations() {
            const durationEl = document.getElementById(`duration-${currentTrack}`);
            if (durationEl && audio.duration) {
                durationEl.textContent = formatTime(audio.duration);
            }
        }

        function mediaPlay() {
            audio.play().then(() => {
                isPlaying = true;
                playBtn.classList.add('playing');
                mediaTicker.classList.remove('paused');
                startVisualizer();
            }).catch(err => console.log('Playback failed:', err));
        }

        function mediaPause() {
            audio.pause();
            isPlaying = false;
            playBtn.classList.remove('playing');
            mediaTicker.classList.add('paused');
            stopVisualizer();
        }

        function mediaStop() {
            audio.pause();
            audio.currentTime = 0;
            isPlaying = false;
            playBtn.classList.remove('playing');
            mediaTicker.classList.add('paused');
            mediaTime.textContent = '0:00';
            mediaSeekThumb.style.left = '4px';
            stopVisualizer();
        }

        function startVisualizer() {
            if (vizInterval) return;
            const bars = mediaVisualizer.querySelectorAll('.viz-bar');
            vizInterval = setInterval(() => {
                bars.forEach((bar) => {
                    const height = Math.max(10, Math.random() * 100);
                    bar.style.height = height + '%';
                });
            }, 100);
        }

        function stopVisualizer() {
            if (vizInterval) { clearInterval(vizInterval); vizInterval = null; }
            const bars = mediaVisualizer.querySelectorAll('.viz-bar');
            bars.forEach((bar, i) => {
                bar.style.height = (20 + Math.sin(i * 0.5) * 15) + '%';
            });
        }

        function prevTrack() {
            if (audio.currentTime > 3) {
                audio.currentTime = 0;
            } else {
                const newIndex = (currentTrack - 1 + playlist.length) % playlist.length;
                loadTrack(newIndex);
                if (isPlaying) mediaPlay();
            }
        }

        function nextTrack() {
            const newIndex = (currentTrack + 1) % playlist.length;
            loadTrack(newIndex);
            if (isPlaying) mediaPlay();
        }

        function updateTimeDisplay() {
            if (!audio.duration) return;
            mediaTime.textContent = formatTime(audio.currentTime);
            const seekBar = document.getElementById('media-seek');
            const percent = audio.currentTime / audio.duration;
            const trackWidth = seekBar.offsetWidth - 8; // Account for padding
            mediaSeekThumb.style.left = (4 + percent * trackWidth) + 'px';
        }

        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        function seekTo(event) {
            const seekBar = document.getElementById('media-seek');
            const rect = seekBar.getBoundingClientRect();
            const percent = (event.clientX - rect.left) / rect.width;
            audio.currentTime = percent * audio.duration;
        }

        function setVolume(event) {
            const volumeBar = event.currentTarget;
            const rect = volumeBar.getBoundingClientRect();
            const percent = Math.max(0, Math.min(1, (event.clientX - rect.left) / rect.width));
            audio.volume = percent;
            mediaVolumeThumb.style.left = (percent * 100) + '%';
        }

        function togglePlay() { isPlaying ? mediaPause() : mediaPlay(); }
        function pauseMusic() { mediaPause(); }
        function stopMusic() { mediaStop(); }

        document.addEventListener('DOMContentLoaded', initMediaPlayer);

        // ==========================================
        // FIREBASE CHAT ROOM
        // ==========================================

        const firebaseConfig = {
            apiKey: "AIzaSyDUcoZ437gcv8w99atWiMixK4ebvpxHwCw",
            authDomain: "santi-guestbook.firebaseapp.com",
            databaseURL: "https://santi-guestbook-default-rtdb.firebaseio.com",
            projectId: "santi-guestbook",
            storageBucket: "santi-guestbook.firebasestorage.app",
            messagingSenderId: "456705609062",
            appId: "1:456705609062:web:2a0feac46c2692bff9cca7"
        };

        let db;
        try {
            firebase.initializeApp(firebaseConfig);
            db = firebase.database();
            initChatRoom();
        } catch (e) {
            console.log('Firebase not configured yet');
            document.getElementById('chat-messages').innerHTML =
                '<div style="text-align: center; color: #666; padding: 20px;">chat coming soon!</div>';
        }

        function initChatRoom() {
            // Listen for status updates
            db.ref('status').on('value', (snapshot) => {
                const status = snapshot.val() || { type: 'online', message: 'welcome to my corner of the internet', lastSeen: Date.now() };
                const indicator = document.getElementById('status-indicator');
                const messageEl = document.getElementById('status-message');
                const lastSeenEl = document.getElementById('status-lastseen');

                indicator.className = 'chat-status-indicator ' + (status.type || 'online');
                messageEl.textContent = status.message || 'welcome to my corner of the internet';
                lastSeenEl.textContent = 'last seen: ' + getRelativeTime(status.lastSeen || Date.now());
            });

            // Listen for chat messages
            const messagesRef = db.ref('guestbook').orderByChild('timestamp').limitToLast(100);
            messagesRef.on('value', (snapshot) => {
                const messagesContainer = document.getElementById('chat-messages');
                const messages = [];
                snapshot.forEach((child) => { messages.push({ id: child.key, ...child.val() }); });

                if (messages.length === 0) {
                    messagesContainer.innerHTML = '<div style="text-align: center; color: #666; padding: 20px;">be the first to say something!</div>';
                    return;
                }

                messagesContainer.innerHTML = messages.map(msg => {
                    const isOwner = msg.isOwner === true;
                    const bubbleClass = isOwner ? 'owner' : 'visitor';
                    const name = isOwner ? 'santi' : escapeHtml(msg.name || 'anon');
                    return `
                        <div class="chat-bubble ${bubbleClass}">
                            <button class="chat-delete" onclick="deleteMessage('${msg.id}')">√ó</button>
                            <div class="chat-bubble-header">
                                <span class="chat-bubble-name">${name}</span>
                                <span class="chat-bubble-time">${getRelativeTime(msg.timestamp)}</span>
                            </div>
                            <div class="chat-bubble-text">${escapeHtml(msg.message)}</div>
                        </div>
                    `;
                }).join('');

                // Scroll to bottom
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            });

        }

        function submitChat() {
            const nameInput = document.getElementById('chat-name');
            const messageInput = document.getElementById('chat-message');
            const message = messageInput.value.trim();
            if (!message) return;

            db.ref('guestbook').push({
                name: nameInput.value.trim() || 'anon',
                message: message,
                timestamp: firebase.database.ServerValue.TIMESTAMP,
                isOwner: false
            }).then(() => {
                messageInput.value = '';
            }).catch(error => {
                console.error('Error posting message:', error);
            });
        }

        function getRelativeTime(timestamp) {
            if (!timestamp) return 'just now';
            const now = Date.now();
            const diff = now - timestamp;
            const seconds = Math.floor(diff / 1000);
            const minutes = Math.floor(seconds / 60);
            const hours = Math.floor(minutes / 60);
            const days = Math.floor(hours / 24);

            if (seconds < 60) return 'just now';
            if (minutes < 60) return minutes + 'm ago';
            if (hours < 24) return hours + 'h ago';
            if (days < 7) return days + 'd ago';
            return new Date(timestamp).toLocaleDateString();
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // ==========================================
        // CHAT ADMIN MODE
        // ==========================================

        const ADMIN_PASSWORD = 'wtf123';
        let isAdminMode = false;
        let clickCount = 0;
        let clickTimer = null;

        document.querySelector('#chat .title-bar').addEventListener('click', (e) => {
            clickCount++;
            if (clickCount === 3) {
                clickCount = 0;
                clearTimeout(clickTimer);
                toggleAdminMode();
            } else {
                clearTimeout(clickTimer);
                clickTimer = setTimeout(() => { clickCount = 0; }, 500);
            }
        });

        function toggleAdminMode() {
            if (!isAdminMode) {
                const password = prompt('enter admin password:');
                if (password === ADMIN_PASSWORD) {
                    isAdminMode = true;
                    document.getElementById('chat').classList.add('admin-mode');
                }
            } else {
                isAdminMode = false;
                document.getElementById('chat').classList.remove('admin-mode');
            }
        }

        function updateStatus() {
            if (!isAdminMode) {
                alert('not in admin mode');
                return;
            }
            const type = document.getElementById('admin-status-type').value;
            const message = document.getElementById('admin-status-message').value.trim();

            console.log('updating status:', type, message);

            db.ref('status').set({
                type: type,
                message: message || 'welcome to my corner of the internet',
                lastSeen: firebase.database.ServerValue.TIMESTAMP
            }).then(() => {
                console.log('status updated successfully');
                document.getElementById('admin-status-message').value = '';
            }).catch(err => {
                console.error('status update failed:', err);
                alert('failed to update status: ' + err.message);
            });
        }

        function postAsOwner() {
            if (!isAdminMode) return;
            const messageInput = document.getElementById('admin-chat-message');
            const message = messageInput.value.trim();
            if (!message) return;

            db.ref('guestbook').push({
                name: 'santi',
                message: message,
                timestamp: firebase.database.ServerValue.TIMESTAMP,
                isOwner: true
            }).then(() => {
                messageInput.value = '';
                // Also update lastSeen
                db.ref('status/lastSeen').set(firebase.database.ServerValue.TIMESTAMP);
            }).catch(err => alert('failed to post: ' + err.message));
        }

        function deleteMessage(messageId) {
            if (!isAdminMode) return;
            if (confirm('delete this message?')) {
                db.ref('guestbook/' + messageId).remove()
                    .catch(err => alert('failed to delete: ' + err.message));
            }
        }
    </script>
</body>
</html>