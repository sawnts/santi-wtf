<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>now â€” santi.wtf</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'MS Sans Serif', 'Segoe UI', Tahoma, Arial, sans-serif;
            font-size: 12px;
            background: #c0c0c0;
            color: #000;
            overflow: auto;
            line-height: 1.4;
        }

        .container {
            padding: 8px;
        }

        /* Tab bar - physically connected to content pane */
        .tabs {
            display: flex;
            gap: 0;
            margin-bottom: 0;
            position: relative;
            z-index: 2;
            padding-left: 4px;
        }

        .tab {
            padding: 4px 16px;
            background: #c0c0c0;
            border: 2px solid;
            border-color: #fff #808080 #c0c0c0 #fff;
            border-bottom: none;
            cursor: pointer;
            font-size: 12px;
            font-family: inherit;
            margin-right: 2px;
            position: relative;
            top: 2px;
        }

        .tab:hover {
            background: #d4d4d4;
        }

        .tab:active {
            border-color: #808080 #fff #c0c0c0 #808080;
        }

        .tab.active {
            background: #c0c0c0;
            border-color: #fff #808080 #c0c0c0 #fff;
            top: 2px;
            padding-bottom: 6px;
            z-index: 3;
        }

        .tab-panel {
            border: 2px solid;
            border-color: #fff #808080 #808080 #fff;
            background: #c0c0c0;
            padding: 16px;
            position: relative;
            z-index: 1;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Group boxes - inset style */
        .group-box {
            border: 2px solid;
            border-color: #808080 #fff #fff #808080;
            padding: 16px 12px 12px 12px;
            margin-bottom: 16px;
            position: relative;
        }

        .group-box-title {
            position: absolute;
            top: -7px;
            left: 8px;
            background: #c0c0c0;
            padding: 0 4px;
            font-size: 12px;
        }

        /* Stat rows - 8px gutter, vertical centering */
        .stat-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 4px 0;
            gap: 8px;
        }

        .stat-label {
            color: #000;
            min-width: 80px;
        }

        /* Inset field for dynamic data */
        .stat-value {
            font-family: 'Courier New', monospace;
            background: #fff;
            border: 2px solid;
            border-color: #808080 #fff #fff #808080;
            padding: 2px 8px;
            min-width: 120px;
            text-align: left;
            flex: 1;
        }

        /* Status display - also in inset field */
        .status-row {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 4px 0;
        }

        .status-field {
            display: flex;
            align-items: center;
            gap: 8px;
            background: #fff;
            border: 2px solid;
            border-color: #808080 #fff #fff #808080;
            padding: 4px 8px;
            flex: 1;
        }

        .status-dot {
            display: inline-block;
            width: 8px;
            height: 8px;
            flex-shrink: 0;
        }

        .status-online {
            background: #00aa00;
            border: 1px solid #006600;
        }

        .status-offline {
            background: #808080;
            border: 1px solid #404040;
        }

        /* Big number display */
        .big-stat-container {
            text-align: center;
            padding: 8px;
        }

        .big-stat {
            font-family: 'Courier New', monospace;
            font-size: 24px;
            color: #000080;
            background: #fff;
            border: 2px solid;
            border-color: #808080 #fff #fff #808080;
            padding: 8px 16px;
            display: inline-block;
            min-width: 100px;
        }

        .big-stat-label {
            font-size: 12px;
            color: #000;
            margin-top: 4px;
        }

        /* Progress bars */
        .progress-container {
            margin: 8px 0;
        }

        .progress-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 4px;
            font-size: 12px;
        }

        .progress-bar {
            height: 16px;
            background: #fff;
            border: 2px solid;
            border-color: #808080 #fff #fff #808080;
        }

        .progress-fill {
            height: 100%;
            background: #000080;
        }

        .progress-fill.green { 
            background: #008000;
        }

        /* List view */
        .list-view {
            border: 2px solid;
            border-color: #808080 #fff #fff #808080;
            background: #fff;
        }

        .list-header {
            display: flex;
            background: #c0c0c0;
        }

        .list-header-cell {
            padding: 2px 8px;
            flex: 1;
            border: 2px solid;
            border-color: #fff #808080 #808080 #fff;
            margin-right: -2px;
        }

        .list-row {
            display: flex;
            border-bottom: 1px solid #c0c0c0;
            background: #fff;
        }

        .list-row:last-child {
            border-bottom: none;
        }

        .list-row:hover {
            background: #000080;
            color: #fff;
        }

        .list-cell {
            padding: 2px 8px;
            flex: 1;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        /* Habit rows */
        .habit-row {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 4px;
        }

        .habit-name {
            width: 70px;
            font-size: 12px;
        }

        .habit-track {
            display: flex;
            align-items: center;
            gap: 8px;
            flex: 1;
            background: #fff;
            border: 2px solid;
            border-color: #808080 #fff #fff #808080;
            padding: 2px 4px;
        }

        .habit-days {
            display: flex;
            gap: 1px;
            flex: 1;
        }

        .habit-day {
            width: 6px;
            height: 10px;
            background: #c0c0c0;
        }

        .habit-day.done {
            background: #008000;
        }

        .habit-day.today {
            border: 1px solid #000080;
        }

        .habit-count {
            font-family: monospace;
            font-size: 12px;
            min-width: 35px;
            text-align: right;
        }

        /* Two column layout */
        .two-col {
            display: flex;
            gap: 16px;
        }

        .two-col > div {
            flex: 1;
        }

        /* Status bar at bottom */
        .status-bar {
            border: 2px solid;
            border-color: #808080 #fff #fff #808080;
            padding: 2px 8px;
            font-size: 12px;
            margin-top: 8px;
            display: flex;
            gap: 16px;
        }

        .status-bar a {
            color: #0000ff;
        }

        .status-bar a:visited {
            color: #800080;
        }

        /* Icon placeholders - 16x16 inline */
        .icon-16 {
            width: 16px;
            height: 16px;
            display: inline-block;
            vertical-align: middle;
            margin-right: 4px;
            image-rendering: pixelated;
        }

        /* Dithered energy bar using text */
        .energy-bar {
            font-family: monospace;
            letter-spacing: 1px;
        }

        @media (max-width: 600px) {
            .two-col {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Tabs -->
        <div class="tabs">
            <div class="tab active" onclick="showTab('general')">General</div>
            <div class="tab" onclick="showTab('performance')">Performance</div>
            <div class="tab" onclick="showTab('processes')">Processes</div>
        </div>

        <div class="tab-panel">
            <!-- General Tab -->
            <div class="tab-content active" id="tab-general">
                <div class="two-col">
                    <div>
                        <div class="group-box">
                            <div class="group-box-title">Status</div>
                            <div class="status-row">
                                <span class="stat-label">Current:</span>
                                <div class="status-field">
                                    <span class="status-dot status-online" id="status-dot"></span>
                                    <span id="current-status">loading...</span>
                                </div>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">Location:</span>
                                <span class="stat-value">Seattle, WA</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">Local Time:</span>
                                <span class="stat-value" id="local-time">--:--</span>
                            </div>
                        </div>

                        <div class="group-box">
                            <div class="group-box-title">Currently Reading</div>
                            <div class="stat-row">
                                <span class="stat-label">Title:</span>
                                <span class="stat-value" id="book-title">...</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">Author:</span>
                                <span class="stat-value" id="book-author">...</span>
                            </div>
                            <div class="progress-container">
                                <div class="progress-label">
                                    <span>Progress</span>
                                    <span id="book-progress-text">0%</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill green" id="book-progress" style="width: 0%;"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div>
                        <div class="group-box">
                            <div class="group-box-title">Vibes</div>
                            <div class="stat-row">
                                <span class="stat-label">Mood:</span>
                                <span class="stat-value" id="vibes-mood">...</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">Caffeine:</span>
                                <span class="stat-value" id="vibes-caffeine">...</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">Energy:</span>
                                <span class="stat-value energy-bar" id="vibes-energy">...</span>
                            </div>
                        </div>

                        <div class="group-box">
                            <div class="group-box-title">Garden Stats</div>
                            <div class="stat-row">
                                <span class="stat-label">Notes:</span>
                                <span class="stat-value" id="garden-notes">...</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">Links:</span>
                                <span class="stat-value" id="garden-links">...</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">Last Tended:</span>
                                <span class="stat-value" id="garden-tended">...</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">Stages:</span>
                                <span class="stat-value" id="garden-stages">...</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Performance Tab -->
            <div class="tab-content" id="tab-performance">
                <div class="two-col">
                    <div>
                        <div class="group-box">
                            <div class="group-box-title">Chess.com</div>
                            <div class="big-stat-container">
                                <div class="big-stat" id="chess-rating">...</div>
                                <div class="big-stat-label">Rapid Rating</div>
                            </div>
                            <div class="progress-container">
                                <div class="progress-label">
                                    <span>1000</span>
                                    <span>Goal: 1500</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill" id="chess-progress" style="width: 0%;"></div>
                                </div>
                            </div>
                        </div>

                    </div>

                    <div>
                        <div class="group-box">
                            <div class="group-box-title">Habits - January</div>
                            <div id="habits-container">
                                <div style="color: #808080; padding: 8px;">loading...</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Processes Tab -->
            <div class="tab-content" id="tab-processes">
                <div class="group-box">
                    <div class="group-box-title">Active Projects</div>
                    <div class="list-view" style="margin-top: 4px;">
                        <div class="list-header">
                            <div class="list-header-cell">Name</div>
                            <div class="list-header-cell">Status</div>
                            <div class="list-header-cell">Notes</div>
                        </div>
                        <div class="list-row">
                            <div class="list-cell">secret proj</div>
                            <div class="list-cell">Running</div>
                            <div class="list-cell">something cool</div>
                        </div>
                        <div class="list-row">
                            <div class="list-cell">santi.wtf</div>
                            <div class="list-cell">Running</div>
                            <div class="list-cell">always evolving</div>
                        </div>
                        <div class="list-row">
                            <div class="list-cell">santi's letter</div>
                            <div class="list-cell">Running</div>
                            <div class="list-cell">weekly-ish</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script>
        // ============ TABS ============
        function showTab(tabId) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            
            document.querySelector(`.tab[onclick="showTab('${tabId}')"]`).classList.add('active');
            document.getElementById('tab-' + tabId).classList.add('active');
        }

        // ============ TIME & STATUS ============
        let nowDataOverrides = {};

        function updateTime() {
            const now = new Date();
            const time = now.toLocaleTimeString('en-US', { 
                hour: '2-digit', 
                minute: '2-digit',
                timeZone: 'America/Los_Angeles'
            });
            document.getElementById('local-time').textContent = time;

            const hour = parseInt(now.toLocaleString('en-US', { hour: 'numeric', hour12: false, timeZone: 'America/Los_Angeles' }));
            const status = document.getElementById('current-status');
            const statusDot = document.getElementById('status-dot');

            // Status - check for override first
            if (nowDataOverrides.status) {
                status.textContent = nowDataOverrides.status;
                statusDot.className = 'status-dot status-online';
            } else {
                if (hour >= 0 && hour < 8) {
                    status.textContent = "probably sleeping";
                    statusDot.className = 'status-dot status-offline';
                } else if (hour >= 8 && hour < 17) {
                    status.textContent = "slinging software @ work";
                    statusDot.className = 'status-dot status-online';
                } else if (hour >= 19 && hour < 20) {
                    status.textContent = "dinner with kai";
                    statusDot.className = 'status-dot status-online';
                } else {
                    status.textContent = "probably building something";
                    statusDot.className = 'status-dot status-online';
                }
            }
        }

        // ============ CHESS.COM API ============
        async function fetchChessRating() {
            try {
                const response = await fetch('https://api.chess.com/pub/player/sawnts/stats');
                const data = await response.json();
                
                const rapidRating = data.chess_rapid?.last?.rating || 'N/A';
                document.getElementById('chess-rating').textContent = rapidRating;
                
                if (typeof rapidRating === 'number') {
                    const progress = Math.min(100, Math.max(0, ((rapidRating - 1000) / 500) * 100));
                    document.getElementById('chess-progress').style.width = progress + '%';
                }
            } catch (e) {
                document.getElementById('chess-rating').textContent = 'offline';
            }
        }

        // ============ GARDEN STATS ============
        async function fetchGardenStats() {
            try {
                const response = await fetch('/garden/data/index.json');
                const data = await response.json();
                
                const notes = Object.keys(data.notes).length;
                let links = 0;
                let seedling = 0, growing = 0, evergreen = 0;
                let lastTended = new Date(0);

                for (const note of Object.values(data.notes)) {
                    links += (note.links || []).length;
                    if (note.stage === 'seedling') seedling++;
                    else if (note.stage === 'growing') growing++;
                    else if (note.stage === 'evergreen') evergreen++;
                    
                    const tended = new Date(note.tended);
                    if (tended > lastTended) lastTended = tended;
                }

                document.getElementById('garden-notes').textContent = notes;
                document.getElementById('garden-links').textContent = links;
                
                const today = new Date();
                const diffDays = Math.floor((today - lastTended) / (1000 * 60 * 60 * 24));
                document.getElementById('garden-tended').textContent = diffDays === 0 ? 'today' : diffDays === 1 ? 'yesterday' : diffDays + 'd ago';
                
                // Use text instead of emojis for stages
                document.getElementById('garden-stages').textContent = `seed:${seedling} grow:${growing} tree:${evergreen}`;
            } catch (e) {
                console.error('Garden stats error:', e);
            }
        }

        // ============ HABITS ============
        async function fetchHabits() {
            try {
                const response = await fetch('/garden/data/habits-config.json');
                const data = await response.json();
                
                const today = new Date();
                const dayOfMonth = today.getDate();
                
                const container = document.getElementById('habits-container');
                container.innerHTML = '';

                for (const habit of data.habits) {
                    const completedDays = habit.completed || [];
                    
                    const row = document.createElement('div');
                    row.className = 'habit-row';
                    
                    let daysHtml = '';
                    for (let d = 1; d <= dayOfMonth; d++) {
                        const isDone = completedDays.includes(d);
                        const isToday = d === dayOfMonth;
                        daysHtml += `<div class="habit-day${isDone ? ' done' : ''}${isToday ? ' today' : ''}"></div>`;
                    }
                    
                    row.innerHTML = `
                        <div class="habit-name">${habit.name}</div>
                        <div class="habit-track">
                            <div class="habit-days">${daysHtml}</div>
                            <div class="habit-count">${completedDays.length}/${dayOfMonth}</div>
                        </div>
                    `;
                    container.appendChild(row);
                }
            } catch (e) {
                console.error('Habits error:', e);
                document.getElementById('habits-container').innerHTML = '<span style="color: #800000;">error loading</span>';
            }
        }

        // ============ NOW DATA ============
        async function fetchNowData() {
            try {
                const response = await fetch('/garden/data/now-data.json');
                nowDataOverrides = await response.json();
                
                // Update reading
                if (nowDataOverrides.reading) {
                    const r = nowDataOverrides.reading;
                    document.getElementById('book-title').textContent = r.title || 'unknown';
                    document.getElementById('book-author').textContent = r.author || '';
                    if (r.progress) {
                        document.getElementById('book-progress').style.width = r.progress + '%';
                        document.getElementById('book-progress-text').textContent = r.progress + '%';
                    }
                }
                
                // Update vibes - no emojis, use ASCII/text
                if (nowDataOverrides.mood) {
                    document.getElementById('vibes-mood').textContent = nowDataOverrides.mood;
                }
                if (nowDataOverrides.caffeine) {
                    // Use text instead of emoji
                    const cups = nowDataOverrides.caffeine;
                    document.getElementById('vibes-caffeine').textContent = cups + ' cup' + (cups > 1 ? 's' : '');
                }
                if (nowDataOverrides.energy) {
                    // Dithered bar using block chars
                    const filled = Math.round(nowDataOverrides.energy);
                    const empty = 10 - filled;
                    document.getElementById('vibes-energy').textContent = '\u2588'.repeat(filled) + '\u2591'.repeat(empty);
                }
            } catch (e) {
                console.error('Now data error:', e);
            }
        }

        // ============ INIT ============
        async function init() {
            await fetchNowData();
            updateTime();
            setInterval(updateTime, 60000);
            
            fetchChessRating();
            fetchGardenStats();
            fetchHabits();
        }
        
        init();
    </script>
</body>
</html>
